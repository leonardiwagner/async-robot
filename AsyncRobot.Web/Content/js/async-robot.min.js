(function(){this.Hub=function(){function Hub(){}var asyncRobotHub,startExplore;return asyncRobotHub=$.connection.asyncRobotHub,$.connection.hub.start().done(function(){return console.log("hub carregado de tiro porrada e bomba")}),asyncRobotHub.client.setRobotPosition=function(id,x,y){return maze.setRobotPosition(id,x,y),console.log("robot "+id+" "+x+" "+y)},startExplore=function(maze,robots){return asyncRobotHub.server.runRobot(maze,robots)},Hub}()}).call(this),function(){this.Maze=function(){function Maze(){}var changeObject,createMaze,createMazeObjectHandler,createMazeObjectHandlers,loadMap,maze,mazeObjectSize,mazeToJson,robotToJson,setRobotInMaze,setRobotPosition,startExplore;return maze=$("#maze"),mazeObjectSize=10,createMaze=function(jsonMaze){var html,lastY,mazeHeight,mazeObjectCount,mazeObjectPerLine,mazeTrack,mazeWidth,num,objectX,objectY,trackItem,_i,_ref;for(this.maze.empty(),void 0!==jsonMaze?(mazeWidth=jsonMaze.width,mazeHeight=jsonMaze.height,mazeTrack=jsonMaze.track,$("#txtMazeWidth").val(mazeWidth),$("#txtMazeHeight").val(mazeHeight)):(mazeWidth=$("#txtMazeWidth").val(),mazeHeight=$("#txtMazeHeight").val(),mazeTrack=null),mazeObjectPerLine=parseInt(mazeWidth)-1,mazeObjectCount=mazeWidth*mazeHeight,trackItem=0,objectX=0,objectY=0,lastY=0,html="<div class='line'>",num=_i=0,_ref=mazeObjectCount-1;_ref>=0?_ref>=_i:_i>=_ref;num=_ref>=0?++_i:--_i)objectY!==lastY&&(lastY=objectY,lastY>0&&(html+="</div>"),html+="<div class='line'>"),null!==mazeTrack&&mazeTrack[trackItem].x===objectX&&mazeTrack[trackItem].y===objectY?(html+="<div class='mazeObject space' data-x='"+objectX+"' data-y='"+objectY+"'></div>",mazeTrack.length>trackItem+1&&trackItem++):html+="<div class='mazeObject wall' data-x='"+objectX+"' data-y='"+objectY+"'></div>",objectX===mazeObjectPerLine?(objectX=0,objectY++):objectX++;return html+="</div>",this.maze.append(html)},mazeToJson=function(){var a,objectX,objectY,objectsPerLine,returnJSON,txtMazeHeight,txtMazeWidth;return txtMazeHeight=$("#txtMazeHeight").val(),txtMazeWidth=$("#txtMazeWidth").val(),objectsPerLine=parseInt(txtMazeWidth)-1,objectY=0,objectX=0,returnJSON="{",returnJSON+='    "width":'+txtMazeWidth,returnJSON+='    ,"height":'+txtMazeHeight,returnJSON+='    ,"track": [',$.each($(".mazeObject"),function(){var objectValue;return $(this).hasClass("space")&&(objectValue="space",returnJSON+='{"x": '+objectX+', "y": '+objectY+" },"),objectX===objectsPerLine?(objectX=0,objectY++):objectX++}),a=returnJSON.length,returnJSON=returnJSON.substring(0,a-1),returnJSON+="    ]",returnJSON+="}"},robotToJson=function(){var a,returnJSON;return returnJSON="[",$.each($(".robot"),function(){var id,x,y;return id=$(this).attr("data-id"),x=$(this).attr("data-x"),y=$(this).attr("data-y"),returnJSON+='{"id":'+id+', "x": '+x+', "y": '+y+" },"}),a=returnJSON.length,returnJSON=returnJSON.substring(0,a-1),returnJSON+="]"},loadMap=function(mapName){return void $.get("/Content/maze/"+mapName+".html",function(data){return createMaze(JSON.parse(data))})},setRobotInMaze=function(robotCount){var coordinate,html,num,randomSpace,robotX,robotY,trackCount,tracks,_i,_ref,_results;for(tracks=JSON.parse(mazeToJson()).track,trackCount=tracks.length,_results=[],num=_i=0,_ref=robotCount-1;_ref>=0?_ref>=_i:_i>=_ref;num=_ref>=0?++_i:--_i)randomSpace=Math.floor(Math.random()*trackCount),robotX=tracks[randomSpace].x,robotY=tracks[randomSpace].y,coordinate=robotX+"-"+robotY,html="<div class='mazeObject robot' data-x='"+robotX+"'  data-y='"+robotY+"' data-id='"+num+"'></div>",$("#maze").append(html),_results.push(setRobotPosition(num,robotX,robotY));return _results},changeObject=function(){var landObject,_i,_len,_results;for(_results=[],_i=0,_len=json.length;_len>_i;_i++)landObject=json[_i],"space"===landObject.value?($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").removeClass("wall"),_results.push($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").addClass("space"))):($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").removeClass("space"),_results.push($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").addClass("wall")));return _results},setRobotPosition=function(robotId,x,y){var objectX,objectY;return objectX=x*mazeObjectSize,objectY=y*mazeObjectSize,$(".robot[data-id="+robotId+"]").css("left",objectX+"px").css("top",objectY+"px")},startExplore=function(){var robots;return maze=this.mazeToJson(),robots=this.robotToJson(),this.hub.startExplore(maze,robots)},createMazeObjectHandlers=function(){return $(".mazeObject").click(function(){return createMazeObjectHandler(this)})},createMazeObjectHandler=function(obj){return $(obj).hasClass("wall")?($(obj).removeClass("wall"),$(obj).addClass("space")):$(obj).hasClass("space")?($(obj).removeClass("space"),$(obj).addClass("wall")):void 0},Maze}()}.call(this),function(){var Console;Console=function(){function Console(){}return Console}()}.call(this),function(){$(function(){var Hub,Maze,maze;return Hub=function(){function Hub(){}var asyncRobotHub;return asyncRobotHub=$.connection.asyncRobotHub,$.connection.hub.start().done(function(){return console.log("hub carregado de tiro porrada e bomba")}),asyncRobotHub.client.setRobotReached=function(id,x,y){return maze.setRobotPosition(id,x,y),$(".robot[data-id="+id+"]").remove()},asyncRobotHub.client.setRobotPosition=function(id,x,y){return maze.setRobotPosition(id,x,y),console.log("robot "+id+" "+x+" "+y)},Hub.prototype.startExplore=function(maze,robots){return asyncRobotHub.server.runRobotAsync(maze,robots)},Hub}(),Maze=function(){function Maze(){}var changeObject,createMaze,createMazeObjectHandler,createMazeObjectHandlers,hub,maze,mazeObjectSize,robotToJson;return maze=$("#maze"),mazeObjectSize=10,hub=new Hub(Maze),createMaze=function(jsonMaze){var html,lastY,mazeHeight,mazeObjectCount,mazeObjectPerLine,mazeTrack,mazeWidth,num,objectX,objectY,trackItem,_i,_ref;for(maze.empty(),void 0!==jsonMaze?(mazeWidth=jsonMaze.width,mazeHeight=jsonMaze.height,mazeTrack=jsonMaze.track,$("#txtMazeWidth").val(mazeWidth),$("#txtMazeHeight").val(mazeHeight)):(mazeWidth=$("#txtMazeWidth").val(),mazeHeight=$("#txtMazeHeight").val(),mazeTrack=null),mazeObjectPerLine=parseInt(mazeWidth)-1,mazeObjectCount=mazeWidth*mazeHeight,trackItem=0,objectX=0,objectY=0,lastY=0,html="<div class='line'>",num=_i=0,_ref=mazeObjectCount-1;_ref>=0?_ref>=_i:_i>=_ref;num=_ref>=0?++_i:--_i)objectY!==lastY&&(lastY=objectY,lastY>0&&(html+="</div>"),html+="<div class='line'>"),null!==mazeTrack&&mazeTrack[trackItem].x===objectX&&mazeTrack[trackItem].y===objectY?(html+="<div class='mazeObject space' data-x='"+objectX+"' data-y='"+objectY+"'></div>",mazeTrack.length>trackItem+1&&trackItem++):html+="<div class='mazeObject wall' data-x='"+objectX+"' data-y='"+objectY+"'></div>",objectX===mazeObjectPerLine?(objectX=0,objectY++):objectX++;return html+="</div>",maze.append(html),createMazeObjectHandlers()},Maze.prototype.mazeToJson=function(){var a,objectX,objectY,objectsPerLine,returnJSON,txtMazeHeight,txtMazeWidth;return txtMazeHeight=$("#txtMazeHeight").val(),txtMazeWidth=$("#txtMazeWidth").val(),objectsPerLine=parseInt(txtMazeWidth)-1,objectY=0,objectX=0,returnJSON="{",returnJSON+='    "width":'+txtMazeWidth,returnJSON+='    ,"height":'+txtMazeHeight,returnJSON+='    ,"track": [',$.each($(".mazeObject"),function(){var objectValue;return $(this).hasClass("space")&&(objectValue="space",returnJSON+='{"x": '+objectX+', "y": '+objectY+" },"),objectX===objectsPerLine?(objectX=0,objectY++):objectX++}),a=returnJSON.length,returnJSON=returnJSON.substring(0,a-1),returnJSON+="    ]",returnJSON+="}"},robotToJson=function(){var a,returnJSON;return returnJSON="[",$.each($(".robot"),function(){var id,x,y;return id=$(this).attr("data-id"),x=$(this).attr("data-x"),y=$(this).attr("data-y"),returnJSON+='{"id":'+id+', "x": '+x+', "y": '+y+" },"}),a=returnJSON.length,returnJSON=returnJSON.substring(0,a-1),returnJSON+="]"},Maze.prototype.loadMap=function(mapName){return void $.get("/Content/maze/"+mapName+".html",function(data){return createMaze(JSON.parse(data))})},Maze.prototype.setRobotInMaze=function(robotCount){var coordinate,html,num,randomSpace,robotX,robotY,trackCount,tracks,_i,_ref,_results;for(tracks=JSON.parse(this.mazeToJson()).track,trackCount=tracks.length,_results=[],num=_i=0,_ref=robotCount-1;_ref>=0?_ref>=_i:_i>=_ref;num=_ref>=0?++_i:--_i)randomSpace=Math.floor(Math.random()*trackCount),robotX=tracks[randomSpace].x,robotY=tracks[randomSpace].y,coordinate=robotX+"-"+robotY,html="<div class='mazeObject robot' data-x='"+robotX+"'  data-y='"+robotY+"' data-id='"+num+"'></div>",$("#maze").append(html),_results.push(this.setRobotPosition(num,robotX,robotY));return _results},changeObject=function(){var landObject,_i,_len,_results;for(_results=[],_i=0,_len=json.length;_len>_i;_i++)landObject=json[_i],"space"===landObject.value?($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").removeClass("wall"),_results.push($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").addClass("space"))):($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").removeClass("space"),_results.push($(".mazeObject[data-x='"+landObject.x+"-"+landObject.y+"']").addClass("wall")));return _results},Maze.prototype.setRobotPosition=function(robotId,x,y){var objectX,objectY;return objectX=x*mazeObjectSize,objectY=y*mazeObjectSize,$(".robot[data-id="+robotId+"]").css("left",objectX+"px").css("top",objectY+"px")},Maze.prototype.startExplore=function(){var robots;return maze=this.mazeToJson(),robots=robotToJson(),hub.startExplore(maze,robots)},createMazeObjectHandlers=function(){return $(".mazeObject").click(function(){return createMazeObjectHandler(this)})},createMazeObjectHandler=function(obj){return $(obj).hasClass("wall")?($(obj).removeClass("wall"),$(obj).addClass("space")):$(obj).hasClass("space")?($(obj).removeClass("space"),$(obj).addClass("wall")):void 0},Maze}(),maze=new Maze,maze.loadMap("simple"),maze.mazeToJson(),$("#btnMazeSetRobot").click(function(){return maze.setRobotInMaze($("#txtMazeRobotCount").val())}),$("#btnMazeRun").click(function(){return maze.startExplore()}),$("#btnMazeCreate").click(function(){}),$("#btnMazeStop").click(function(){}),$("#btnMazeImport").click(function(){}),$("#btnMazeExport").click(function(){return $("#txtMazeJson").val(maze.mazeToJson())})})}.call(this);